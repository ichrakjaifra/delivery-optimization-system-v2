<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <!-- ChangeSet 1: Ajout de customer_id à la table deliveries -->
    <changeSet id="v2.1-1" author="votre_nom">
        <comment>Ajout de la colonne customer_id à la table deliveries et suppression des colonnes redondantes</comment>

        <addColumn tableName="deliveries">
            <column name="customer_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_delivery_customer"
                             referencedTableName="customers" referencedColumnNames="id"/>
            </column>
        </addColumn>

        <rollback>
            <dropColumn tableName="deliveries" columnName="customer_id"/>
        </rollback>
    </changeSet>

    <!-- ChangeSet 2: Suppression des colonnes redondantes de deliveries -->
    <changeSet id="v2.1-2" author="votre_nom">
        <comment>Suppression des colonnes address, latitude, longitude de deliveries (déplacées vers customers)</comment>

        <dropColumn tableName="deliveries" columnName="address"/>
        <dropColumn tableName="deliveries" columnName="latitude"/>
        <dropColumn tableName="deliveries" columnName="longitude"/>

        <rollback>
            <addColumn tableName="deliveries">
                <column name="address" type="VARCHAR(200)">
                    <constraints nullable="false"/>
                </column>
                <column name="latitude" type="DOUBLE">
                    <constraints nullable="false"/>
                </column>
                <column name="longitude" type="DOUBLE">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>

</databaseChangeLog>